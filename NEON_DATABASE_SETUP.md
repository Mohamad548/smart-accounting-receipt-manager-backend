# ğŸ—„ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù‚Ø¯Ù… Ø¨Ù‡ Ù‚Ø¯Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯Ø± Neon

## ğŸ“‹ Ù…Ø±Ø§Ø­Ù„ Ú©Ø§Ù…Ù„

### Ù…Ø±Ø­Ù„Ù‡ 1: ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Neon Console

1. Ø¨Ù‡ [Neon Console](https://console.neon.tech/app/projects/flat-frog-84289534) Ø¨Ø±ÙˆÛŒØ¯
2. ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯
3. Ù¾Ø±ÙˆÚ˜Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (ÛŒØ§ ÛŒÚ© Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯)

---

### Ù…Ø±Ø­Ù„Ù‡ 2: Ø¯Ø±ÛŒØ§ÙØª Connection String

1. Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø®ÙˆØ¯ØŒ Ø±ÙˆÛŒ **"Connection Details"** ÛŒØ§ **"Connect"** Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
2. ÛŒÚ© ØµÙØ­Ù‡ Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØªØµØ§Ù„ Ø¨Ø§Ø² Ù…ÛŒâ€ŒØ´ÙˆØ¯
3. **Connection String** Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯

**Ù…Ø«Ø§Ù„ Connection String:**
```
postgresql://user:password@ep-xxx-xxx.region.aws.neon.tech/neondb?sslmode=require
```

âš ï¸ **Ù…Ù‡Ù…:** Ø§ÛŒÙ† Connection String Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯!

---

### Ù…Ø±Ø­Ù„Ù‡ 3: Ø§Ø¬Ø±Ø§ÛŒ Schema (Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„)

Ø´Ù…Ø§ Ø¯Ùˆ Ø±ÙˆØ´ Ø¯Ø§Ø±ÛŒØ¯:

#### Ø±ÙˆØ´ 1: Ø§Ø² Ø·Ø±ÛŒÙ‚ SQL Editor Ø¯Ø± Neon (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ) âœ…

1. Ø¯Ø± Neon ConsoleØŒ Ø¨Ù‡ **"SQL Editor"** Ø¨Ø±ÙˆÛŒØ¯
2. ÛŒÚ© Query Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯
3. ÙØ§ÛŒÙ„ `backend/src/database/schema.postgresql.sql` Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
4. **ØªÙ…Ø§Ù… Ù…Ø­ØªÙˆØ§ÛŒ** ÙØ§ÛŒÙ„ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯
5. Ø¯Ø± SQL Editor Ù¾ÛŒØ³Øª Ú©Ù†ÛŒØ¯
6. Ø±ÙˆÛŒ **"Run"** ÛŒØ§ **"Execute"** Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
7. Ù…Ù†ØªØ¸Ø± Ø¨Ù…Ø§Ù†ÛŒØ¯ ØªØ§ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯

**Ø§Ú¯Ø± Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ØŒ Ø¨Ø§ÛŒØ¯ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯:**
```
Query executed successfully
```

#### Ø±ÙˆØ´ 2: Ø§Ø² Ø·Ø±ÛŒÙ‚ psql (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)

Ø§Ú¯Ø± `psql` Ù†ØµØ¨ Ø¯Ø§Ø±ÛŒØ¯:

```bash
# Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
psql "YOUR_CONNECTION_STRING_HERE"

# Ø§Ø¬Ø±Ø§ÛŒ schema
\i backend/src/database/schema.postgresql.sql
```

---

### Ù…Ø±Ø­Ù„Ù‡ 4: Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ø¯Ø§ÙˆÙ„

1. Ø¯Ø± SQL EditorØŒ Ø§ÛŒÙ† Query Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:

```sql
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';
```

**Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ø¬Ø¯Ø§ÙˆÙ„ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯:**
- `users`
- `refresh_tokens`
- `creditors`
- `customers`
- `receipt_records`

---

### Ù…Ø±Ø­Ù„Ù‡ 5: ØªØ³Øª Ø§ØªØµØ§Ù„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)

Ø¯Ø± SQL EditorØŒ Ø§ÛŒÙ† Query Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:

```sql
SELECT NOW();
```

Ø§Ú¯Ø± ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø±Ø§ Ø¯ÛŒØ¯ÛŒØ¯ØŒ Ø§ØªØµØ§Ù„ Ø¯Ø±Ø³Øª Ø§Ø³Øª! âœ…

---

## ğŸ“ Ù…Ø­ØªÙˆØ§ÛŒ Schema (Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ)

Ø§Ú¯Ø± ÙØ§ÛŒÙ„ `schema.postgresql.sql` Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯ÛŒØ¯ØŒ Ø§ÛŒÙ† Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯:

```sql
-- Database Schema for Smart Accounting Receipt Manager
-- PostgreSQL Database (for Neon.tech)

-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Users Table (Ú©Ø§Ø±Ø¨Ø±Ø§Ù†)
CREATE TABLE IF NOT EXISTS users (
    id VARCHAR(255) PRIMARY KEY,
    username VARCHAR(255) NOT NULL UNIQUE,
    password_hash TEXT NOT NULL,
    created_at BIGINT NOT NULL,
    updated_at BIGINT NOT NULL DEFAULT EXTRACT(EPOCH FROM NOW())::BIGINT
);

-- Refresh Tokens Table
CREATE TABLE IF NOT EXISTS refresh_tokens (
    id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    token TEXT NOT NULL UNIQUE,
    expires_at BIGINT NOT NULL,
    created_at BIGINT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Creditors Table (ØµØ±Ø§Ùâ€ŒÙ‡Ø§)
CREATE TABLE IF NOT EXISTS creditors (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    account_number VARCHAR(255) NOT NULL,
    sheba_number VARCHAR(255) NOT NULL,
    total_amount DECIMAL(15, 2) NOT NULL DEFAULT 0,
    remaining_amount DECIMAL(15, 2) NOT NULL DEFAULT 0,
    created_at BIGINT NOT NULL,
    updated_at BIGINT NOT NULL DEFAULT EXTRACT(EPOCH FROM NOW())::BIGINT
);

-- Customers Table (Ù…Ø´ØªØ±ÛŒØ§Ù†)
CREATE TABLE IF NOT EXISTS customers (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    expected_amount DECIMAL(15, 2) NOT NULL DEFAULT 0,
    collected_amount DECIMAL(15, 2) NOT NULL DEFAULT 0,
    maturity_date VARCHAR(50) NOT NULL,
    created_at BIGINT NOT NULL,
    updated_at BIGINT NOT NULL DEFAULT EXTRACT(EPOCH FROM NOW())::BIGINT
);

-- Receipt Records Table (ÙÛŒØ´â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø±ÛŒØ²ÛŒ)
CREATE TABLE IF NOT EXISTS receipt_records (
    id VARCHAR(255) PRIMARY KEY,
    customer_id VARCHAR(255) NOT NULL,
    amount DECIMAL(15, 2) NOT NULL,
    date VARCHAR(255) NOT NULL,
    ref_number VARCHAR(255),
    sender TEXT,
    receiver TEXT,
    description TEXT,
    image_url TEXT NOT NULL,
    matched_creditor_id VARCHAR(255),
    dynamic_fields JSONB,
    created_at BIGINT NOT NULL,
    updated_at BIGINT NOT NULL DEFAULT EXTRACT(EPOCH FROM NOW())::BIGINT,
    FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE CASCADE,
    FOREIGN KEY (matched_creditor_id) REFERENCES creditors(id) ON DELETE SET NULL
);

-- Indexes for better performance
CREATE INDEX IF NOT EXISTS idx_receipt_records_customer_id ON receipt_records(customer_id);
CREATE INDEX IF NOT EXISTS idx_receipt_records_ref_number ON receipt_records(ref_number);
CREATE INDEX IF NOT EXISTS idx_receipt_records_created_at ON receipt_records(created_at);
CREATE INDEX IF NOT EXISTS idx_customers_name ON customers(name);
CREATE INDEX IF NOT EXISTS idx_creditors_name ON creditors(name);
CREATE INDEX IF NOT EXISTS idx_users_username ON users(username);
CREATE INDEX IF NOT EXISTS idx_refresh_tokens_token ON refresh_tokens(token);
CREATE INDEX IF NOT EXISTS idx_refresh_tokens_user_id ON refresh_tokens(user_id);
```

---

## âœ… Checklist

- [ ] ÙˆØ§Ø±Ø¯ Neon Console Ø´Ø¯Ù…
- [ ] Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù…
- [ ] Connection String Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù…
- [ ] Ø¨Ù‡ SQL Editor Ø±ÙØªÙ…
- [ ] Schema Ø±Ø§ Ú©Ù¾ÛŒ Ùˆ Ø§Ø¬Ø±Ø§ Ú©Ø±Ø¯Ù…
- [ ] Ø¬Ø¯Ø§ÙˆÙ„ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø±Ø¯Ù… (5 Ø¬Ø¯ÙˆÙ„)
- [ ] Connection String Ø±Ø§ Ø¨Ø±Ø§ÛŒ Render Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù…

---

## ğŸ”§ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ø®Ø·Ø§: "relation already exists"
- Ø§ÛŒÙ† Ø®Ø·Ø§ ÛŒØ¹Ù†ÛŒ Ø¬Ø¯Ø§ÙˆÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
- Ù…Ø´Ú©Ù„ÛŒ Ù†ÛŒØ³ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ù‡ÛŒØ¯

### Ø®Ø·Ø§: "permission denied"
- Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±ÛŒØ¯
- Ø§Ú¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªØŒ Ø¨Ø§ÛŒØ¯ owner Ø¨Ø§Ø´ÛŒØ¯

### Ø®Ø·Ø§: "extension uuid-ossp does not exist"
- Ø§ÛŒÙ† Ø®Ø·Ø§ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¯Ø± Neon Ø±Ø® Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- Ø§Ú¯Ø± Ø±Ø® Ø¯Ø§Ø¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø®Ø· `CREATE EXTENSION` Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯

---

## ğŸ¯ Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

1. **Connection String Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯** - Ø¨Ø±Ø§ÛŒ Render Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯
2. **Ø¯Ø± RenderØŒ Environment Variable `DATABASE_URL` Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯**
3. **ØªØ³Øª Ú©Ù†ÛŒØ¯** - Ø¨Ø¹Ø¯ Ø§Ø² deployØŒ health check Ø±Ø§ ØªØ³Øª Ú©Ù†ÛŒØ¯

---

## ğŸ“¸ ØªØµØ§ÙˆÛŒØ± Ø±Ø§Ù‡Ù†Ù…Ø§ (Ù…Ø±Ø§Ø­Ù„)

### Ù…Ø±Ø­Ù„Ù‡ 1: Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Connection Details
- Ø¯Ø± DashboardØŒ Ø±ÙˆÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
- Ø¯Ø± Ø³Ù…Øª Ú†Ù¾ØŒ "Connection Details" ÛŒØ§ "Connect" Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯

### Ù…Ø±Ø­Ù„Ù‡ 2: SQL Editor
- Ø¯Ø± Ù…Ù†ÙˆÛŒ Ø³Ù…Øª Ú†Ù¾ØŒ "SQL Editor" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
- ÛŒÚ© Query Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯

### Ù…Ø±Ø­Ù„Ù‡ 3: Ø§Ø¬Ø±Ø§ÛŒ Schema
- Schema Ø±Ø§ Ù¾ÛŒØ³Øª Ú©Ù†ÛŒØ¯
- Ø±ÙˆÛŒ "Run" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯

---

## ğŸš€ Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡

Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³:
1. Connection String Ø±Ø§ Ø¯Ø± Render Environment Variables Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
2. Service Ø±Ø§ deploy Ú©Ù†ÛŒØ¯
3. Ú©Ø§Ø±Ø¨Ø± admin Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯

